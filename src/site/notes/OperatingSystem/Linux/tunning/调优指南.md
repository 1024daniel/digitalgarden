---
{"dg-publish":true,"permalink":"/OperatingSystem/Linux/tunning/调优指南/","noteIcon":"","created":"","updated":""}
---

#tune
中心思想：
首先确定网络实验是否正常，使用qperf，iperf等工具对比网络传输实验是否正常，如果网络时延在正常范围的话可能是其他配置(bios)或者软件栈的原因

qperf使用方法

```bash
#服务端
qperf
#客户端
qperf -t 60 --use_bits_per_sec 192.168.11.1 tcp_bw tcp_lat

```

## 网卡调优
查看网卡中断

```bash
cat /proc/interrupts|grep $1|awk -F ':' '{print $1}'

```

查看网卡所在的numa node
```bash
cat /sys/class/net/$1/device/numa_node
```
查看某一个中断绑核
```bash
cat /proc/irq/$1/smp_affinity_list
```
查看一个网卡所有中断绑定在那些核上
```bash
ints=`cat /proc/interrupts|grep $1|awk -F ':' '{print $1}'`
cores=$(for i in $ints;do
			cat /proc/irq/$i/smp_affinity_list
done)
printf "%s\n" "${cores[@]}" | sort -n
```
将网卡的中断均匀绑定到所在numa对应的cores上
```bash
ints=`cat /proc/interrupts|grep $1|awk -F ':' '{print $1}'`
#获取对应的cores
j=${core[0]}
num=${#core[@]}

for i in $ints
do
	echo $j > /proc/irq/$i/smp_affinity_list
	((j++))
	((j=j%num+base))
done

```

查看进程具体的线程情况
```bash
ps -hH -p <pid>
#查看瞬时值
top -H -p <pid>
#持续查看
top -p <pid> 之后点击H
# 或者
cat /proc/<pid>/status
ls /proc/<pid>/task
# 或者使用树状查看
pstree -p <pid>
```
查看当前线程总数
```bash
pstree -p | wc -l
#查看当前内核允许的最大线程数
sysctl -a|grep pid_max
#更改最大允许的线程数
echo "kernel.pid_max=65536" >> /etc/sysctl.conf
sysctl -p
```